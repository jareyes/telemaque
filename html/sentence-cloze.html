<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#2980b9">
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="/css/style.css">
    <title>Cloze Sentence | Telemaque</title>
    <style>
      article {
          align-items: center;
          display: flex;
          justify-content: center;
          margin: 4rem 0;
      }
    </style>
  </head>

  <body>
    <header class="header">
      <h1>Telemaque</h1>
      <nav>
        <a id="link-back" href="/">
          <img src="/img/arrow-back.svg"> Back
        </a>
      </nav>
    </header>
    <article>
      <div id="sentence-cloze"><!-- filled in -->
      </div>
    </article>
    <footer class="sentence-footer">
      <nav>
        <ul>
          <li>
            <a id="link-present" href="#">Read
            </a>
          </li>
          <li>
            <a id="link-play" href="#">Listen
            </a>
          </li>
          <li>
            <a id="link-cloze" href="#">Write
            </a>
          </li>
        </ul>
      </nav>
    </footer>
    <script type="module">
      import Sentence from "/js/sentence.mjs";
      import Cloze from "/js/component/cloze.mjs";

      const query = new URLSearchParams(window.location.search);
      const sentence_id = query.get("sentence_id");

      // Update the footer links
      const $link_present = document.getElementById("link-present");
      $link_present.href = `/html/sentence-present?sentence_id=${sentence_id}`;

      const $link_play = document.getElementById("link-play");
      $link_play.href = `/html/sentence-play?sentence_id=${sentence_id}`;

      const $link_cloze = document.getElementById("link-cloze");
      $link_cloze.href = `/html/sentence-cloze?sentence_id=${sentence_id}`;

      // Show the translation
      const sentence = await Sentence.get(sentence_id);
      const tokens = await Sentence.get_words(sentence_id);
      // Choose a word
      const words = tokens.filter(word => !word.is_punctuation);
      const choice = Math.trunc(words.length * Math.random());
      const $cloze = document.getElementById("sentence-cloze");
      const cloze = new Cloze(sentence, words[choice], $cloze);
      cloze.render();
    </script>
  </body>
</html>
