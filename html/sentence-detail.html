<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#2980b9">
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="/css/style.css">
    <title>Telemaque</title>
    <style>
      #sentence-original {
          padding: 1rem 2rem;
          background: var(--tm-color-background);
      }
    </style>
  </head>

  <body>
    <header class="header">
      <h1>Telemaque</h1>
      <nav>
        <a id="link-back" href="/">
          <img src="/img/arrow-back.svg"> Back
        </a>
      </nav>
    </header>
    <article>
      <header class="subheader">
        <h1 id="text-title"><!-- Filled in --></h1>
        <h2 class="meta" id="text-author"><!-- Filled in --></h2>
        <nav>
          <a class="hidden" id="link-sentence-previous" href="#">Previous</a>
          <a class="hidden" id="link-sentence-next" href="#">Next</a>
        </nav>
      </header>

      <button class="play-button invisible" id="sentence-play-button">
        <img src="/img/play-circle-48dp.svg">
        Play
      </button>
      <div id="sentence-original"><!-- Filled in -->
      </div>

      <section class="meta labeled section">
        <span class="label">Translation</span>
        <p id="sentence-translation"><!-- filled in -->
        </p>
      </section>

      <section class="meta labeled section">
        <span class="label">Note</span>
        <p id="sentence-note"><!-- filled in -->
        </p>
      </section>
    </article>
    <footer class="sentence-footer">
      <nav>
        <ul>
          <li>
            <a id="link-present" href="#">Read
            </a>
          </li>
          <li>
            <a id="link-play" href="#">Listen
            </a>
          </li>
          <li>
            <a id="link-cloze" href="#">Write
            </a>
          </li>
        </ul>
      </nav>
    </footer>
    <script type="module">
      import Text from "/js/text.mjs";
      import Sentence from "/js/sentence.mjs";
      import Speech from "/js/speech-client.mjs";

      const query = new URLSearchParams(window.location.search);
      const sentence_id = query.get("sentence_id");

      // Update the footer links
      const $link_present = document.getElementById("link-present");
      $link_present.href = `/html/sentence-present?sentence_id=${sentence_id}`;

      const $link_play = document.getElementById("link-play");
      $link_play.href = `/html/sentence-play?sentence_id=${sentence_id}`;

      const $link_cloze = document.getElementById("link-cloze");
      $link_cloze.href = `/html/sentence-cloze?sentence_id=${sentence_id}`;

      const sentence = await Sentence.get(sentence_id);
      const text = await Text.get(sentence.text_id);

      // Fill in the blanks
      const $author = document.getElementById("text-author");
      const $title = document.getElementById("text-title");
      $author.textContent = text.author;
      $title.textContent = text.title;

      const $original = document.getElementById("sentence-original");
      const $note = document.getElementById("sentence-note");
      const $translation = document.getElementById("sentence-translation");

      $original.textContent = sentence.original;
      $note.textContent = sentence.note;
      $translation.textContent = sentence.translation;

      // Attach audio to the play button
      const audio = await Speech.audio(sentence.original);
      const $play_button = document.getElementById("sentence-play-button");
      $play_button.classList.remove("invisible");
      $play_button.addEventListener("click", async () => {
          await audio.play();
      });
    </script>
  </body>
</html>
