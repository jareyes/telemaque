<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#2980b9">
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="/css/style.css">
    <title>Telemaque</title>
  </head>

  <body>
    <header>
      <h1>Telemaque</h1>
      <nav>
        <a class="nav-back" href="/">
          <img src="/img/arrow-back.svg"> Back
        </a>
      </nav>
    </header>
    <article>
      <h1>Add a new text</h1>
      <form id="form-text">
        <div class="form-field form-required">
          <label for="title">Title</label>
          <input required name="title" type="text">
        </div>

        <div class="form-field form-required">
          <label for="author">Author</label>
          <input required name="author" type="text">
        </div>

        <div class="form-field">
          <label for="description">Description</label>
          <textarea name="description"></textarea>
        </div>

        <input type="submit" value="Add">
      </form>
    </article>
  </body>

  <script type="module">
    import database from "/js/database.js";
    import createText from "/js/text.js";

    const conn = database.get();
    const Text = createText(conn);

    async function create_text(form_data) {
        const title = form_data.get("title");
        const author = form_data.get("author");
        const description = form_data.get("description")

        // Create the text
        const text_id = await Text.create({
            title,
            author,
            description,
        });
        console.log({
            event: "TextCreate.CREATE",
            title,
            author,
            description,
            text_id,
        });
        // Let's look at it on its own page
        window.location.href=`/html/text-detail?text_id=${text_id}`;
    }
    
    // Get the form
    const $form = document.getElementById("form-text");
    $form.addEventListener("submit", async (event) => {
        // Don't go to the server. Stay right here
        event.preventDefault();
        const form_data = new FormData($form);
        await create_text(form_data);
    });
  </script>
</html>
